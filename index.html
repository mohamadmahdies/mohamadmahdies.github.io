<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="pageTitle">Ú©ØªØ§Ø¨Ú†Ù‡ Ù‡Ø¯ÛŒÙ‡</title>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
      crossorigin="anonymous"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light;
        --bg: #fff8f7;
        --card: #ffffff;
        --accent: #ea5458;
        --accent-light: #fde8e9;
        --text: #1f1a1b;
        --muted: #6b5f60;
        --border: #f0d7d8;
        font-family: "Vazirmatn", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      [hidden] {
        display: none !important;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(150deg, #fff8f7 0%, #fde8e9 45%, #fff8f7 100%);
        color: var(--text);
        line-height: 1.6;
        font-size: 16px;
      }

      .page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px clamp(20px, 4vw, 56px) 64px;
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      .home {
        max-width: 1200px;
        margin: 0 auto;
        padding: 56px clamp(20px, 4vw, 56px) 96px;
        display: flex;
        flex-direction: column;
        gap: 48px;
      }

      .hero {
        background: rgba(255, 255, 255, 0.92);
        border-radius: 28px;
        padding: clamp(32px, 6vw, 56px);
        box-shadow: 0 30px 80px rgba(234, 84, 88, 0.14);
        border: 1px solid rgba(234, 84, 88, 0.12);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 32px;
        align-items: center;
      }

      .hero h1 {
        margin: 0 0 16px;
        font-size: clamp(32px, 6vw, 44px);
        color: var(--accent);
      }

      .tagline {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 14px;
        border-radius: 999px;
        background: var(--accent-light);
        color: var(--accent);
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 16px;
      }

      .hero p {
        margin: 0 0 24px;
        color: var(--muted);
        font-size: 18px;
      }

      .hero-cta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .hero-cta a {
        border-radius: 999px;
        padding: 14px 32px;
        font-weight: 600;
        text-decoration: none;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .hero-cta a.primary {
        background: var(--accent);
        color: #fff;
        box-shadow: 0 12px 30px rgba(61, 90, 128, 0.25);
      }

      .hero-cta a.secondary {
        border: 1px solid var(--accent);
        color: var(--accent);
      }

      .hero-visual {
        background: linear-gradient(145deg, #ea5458, #c63e42);
        color: #fff;
        border-radius: 28px;
        padding: 32px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .hero-visual span {
        opacity: 0.9;
        font-size: 15px;
      }

      .hero-visual p {
        margin: 0;
        color: rgba(255, 255, 255, 0.9);
        font-size: 18px;
        line-height: 1.8;
      }

      .features,
      .steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .feature-card,
      .step-card {
        background: var(--card);
        border-radius: 24px;
        padding: 24px;
        box-shadow: 0 20px 50px rgba(234, 84, 88, 0.08);
        border: 1px solid rgba(234, 84, 88, 0.08);
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .feature-card strong,
      .step-card strong {
        font-size: 18px;
      }

      .feature-card p,
      .step-card p {
        margin: 0;
        color: var(--muted);
      }

      header {
        background: var(--card);
        padding: clamp(24px, 5vw, 40px);
        border-radius: 28px;
        display: grid;
        grid-template-columns: minmax(220px, 320px) 1fr;
        gap: 32px;
        align-items: center;
        box-shadow: 0 25px 65px rgba(234, 84, 88, 0.12);
        border: 1px solid rgba(234, 84, 88, 0.12);
      }

      header img {
        width: 100%;
        border-radius: 22px;
        object-fit: cover;
        aspect-ratio: 3 / 4;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      header img:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.18);
      }

      .profile h1 {
        margin: 0 0 12px;
        font-size: clamp(26px, 5vw, 36px);
        color: var(--accent);
      }

      .calendar-icon-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: var(--accent-light);
        color: var(--accent);
        text-decoration: none;
        transition: all 0.2s ease;
        border: 1px solid rgba(234, 84, 88, 0.2);
        flex-shrink: 0;
      }

      .calendar-icon-link:hover {
        background: var(--accent);
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(234, 84, 88, 0.3);
      }

      .calendar-icon-link svg {
        width: 20px;
        height: 20px;
      }

      .profile p {
        margin: 0 0 12px;
        color: var(--muted);
      }

      #profileBio {
        color: var(--text);
        font-weight: 900;
        display: none;
      }
      #profileDescription {
        font-size: small;
        color: rgba(0, 0, 0, .4);
      }

      .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 16px;
      }

      .tags span {
        padding: 6px 14px;
        border-radius: 999px;
        background: var(--accent-light);
        color: var(--accent);
        font-size: 14px;
      }

      .lists {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .list-card {
        background: var(--card);
        padding: clamp(20px, 4vw, 36px);
        border-radius: 28px;
        box-shadow: 0 18px 45px rgba(234, 84, 88, 0.12);
        border: 1px solid rgba(234, 84, 88, 0.08);
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .ai-suggestions {
        background: #f7f3ff;
        border: 1px solid #e0d4ff;
        box-shadow: 0 18px 45px rgba(91, 79, 216, 0.12);
      }

      .ai-pill {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 10px 18px;
        border-radius: 999px;
        background: linear-gradient(90deg, #5b4fd8, #7c3aed);
        color: #ffffff;
        font-size: 14px;
        font-weight: 800;
        box-shadow: 0 10px 24px rgba(91, 79, 216, 0.35);
        border: none;
      }

      .ai-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 16px;
      }

      .ai-card {
        background: #ffffff;
        border: 1px solid #e4e4ff;
        border-radius: 18px;
        padding: 16px 18px;
        display: grid;
        gap: 8px;
        box-shadow: 0 10px 28px rgba(15, 23, 42, 0.04);
      }

      .ai-card strong {
        font-weight: 700;
        color: #1f1a1b;
      }

      .ai-card small {
        color: #6366f1;
        font-size: 13px;
      }

      /* Override default red theme inside AI box */
      .ai-suggestions .item-price {
        color: #4c51bf;
      }

      .ai-suggestions .item-link a {
        border-color: #5b4fd8;
        color: #5b4fd8;
        background: #f7f3ff;
      }

      .ai-suggestions .item-link a:hover {
        background: #ebe7ff;
      }

      /* Stronger title spacing for AI section */
      .ai-suggestions .list-header {
        background: transparent;
        padding: 0 0 16px;
        margin: 0;
      }

      .ai-suggestions .list-title span {
        color: #4c51bf;
      }

      .list-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }

      .list-title {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .list-title h2 {
        margin: 0;
        font-size: 22px;
      }

      .list-title span {
        color: var(--muted);
        font-size: 14px;
      }

      .counter {
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 10px 16px;
        font-size: 14px;
        color: var(--accent);
      }

      .items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 14px;
      }

      .item {
        border: 1px solid var(--border);
        border-radius: 22px;
        padding: 18px 20px;
        display: flex;
        gap: 12px;
        align-items: center;
        cursor: pointer;
        transition: border 0.2s ease, background 0.2s ease;
        background: #fbfbff;
      }

      .item:hover {
        border-color: var(--accent);
        box-shadow: 0 10px 28px rgba(234, 84, 88, 0.12);
      }

      .item input {
        width: 20px;
        height: 20px;
        accent-color: var(--accent);
      }

      .item-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .item-content strong {
        font-weight: 600;
      }

      .item-content span {
        color: var(--muted);
        font-size: 14px;
      }

      .item-price {
        color: var(--accent);
        font-weight: 600;
        font-size: 15px;
        margin-top: 4px;
      }

      .item-link {
        margin-top: 8px;
      }

      .group-purchase-section {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border);
      }

      .progress-bar-container {
        background: #f0f0f0;
        border-radius: 8px;
        height: 8px;
        overflow: hidden;
        margin: 8px 0;
      }

      .progress-bar-fill {
        background: linear-gradient(90deg, var(--accent), #c63e42);
        height: 100%;
        transition: width 0.3s ease;
        border-radius: 8px;
      }

      .progress-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 8px;
      }

      .progress-amount {
        color: var(--accent);
        font-weight: 600;
      }

      .contribute-btn {
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-top: 8px;
        width: 100%;
      }

      .contribute-btn:hover {
        background: #c63e42;
        transform: translateY(-1px);
      }

      .wallet-link {
        position: fixed;
        bottom: 24px;
        left: 24px;
        background: linear-gradient(135deg, var(--accent), #c63e42);
        color: #fff;
        padding: 14px 24px;
        border-radius: 999px;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 8px 24px rgba(234, 84, 88, 0.3);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
      }

      .wallet-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(234, 84, 88, 0.4);
      }

      .item-link a {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: var(--accent);
        text-decoration: none;
        font-size: 13px;
        padding: 6px 12px;
        border: 1px solid var(--accent);
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      .item-link a:hover {
        background: var(--accent-light);
      }

      .item.checked {
        border-color: var(--accent);
        background: var(--accent-light);
      }

      .item-static {
        cursor: default;
        pointer-events: none;
      }

      .profile-footer {
        text-align: center;
        color: var(--muted);
        font-size: 14px;
        margin-top: 12px;
      }

      .share {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-top: 16px;
      }

      .share button {
        border: none;
        border-radius: 999px;
        padding: 12px 28px;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }

      .share button:hover {
        opacity: 0.9;
      }

      .share span {
        color: var(--muted);
        font-size: 14px;
      }

      @media (max-width: 820px) {
        header {
          grid-template-columns: 1fr;
        }

        header img {
          max-height: 380px;
        }
      }
    </style>
  </head>
  <body>
    <main class="home" id="homePage" hidden>
      <section class="hero">
        <div>
          <span class="tagline">Ú©ØªØ§Ø¨Ú†Ù‡ Ù‡Ø¯ÛŒÙ‡</span>
          <h1>Ù„ÛŒØ³Øª Ù‡Ø¯ÛŒÙ‡ Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯ÙˆØ³Øª</h1>
          <p>
            Ø¨Ø§ Ú©ØªØ§Ø¨Ú†Ù‡ Ù‡Ø¯ÛŒÙ‡ØŒ Ù‡Ø± Ø¯ÙˆØ³Øª ÛŒØ§ Ù‡Ù…â€ŒØªÛŒÙ…ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¹Ù„Ø§ÛŒÙ‚ Ùˆ Ù†ÛŒØ§Ø²Ù‡Ø§ÛŒØ´ Ø±Ø§ Ø¯Ø± ÛŒÚ©
            ØµÙØ­Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ù†Ø¯ ØªØ§ Ø¨Ù‚ÛŒÙ‡ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ÛŒÙ† Ù‡Ø¯ÛŒÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ù†Ø¯. ØªØ¬Ø±Ø¨Ù‡â€ŒØ§ÛŒ Ø³Ø§Ø¯Ù‡ØŒ
            Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø¨Ù‡â€ŒÛŒØ§Ø¯Ù…Ø§Ù†Ø¯Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø¯ÛŒÙ‡ Ø¯Ø§Ø¯Ù†.
          </p>
          <div class="hero-cta">
            <a class="primary" href="mailto:hello@esmailiyan.com">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ø³Ø®Ù‡ ØªØ³Øª</a>
            <a class="secondary" href="#features">Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„</a>
          </div>
        </div>
        <div class="hero-visual">
          <strong>ÛŒÚ© ØµÙØ­Ù‡ Ø´Ø®ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙØ±Ø¯</strong>
          <span> </span>
          <p>
            Ø¹Ù„Ø§ÛŒÙ‚ØŒ Ø¨ÙˆØ¯Ø¬Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ùˆ Ù„ÛŒÙ†Ú© Ø®Ø±ÛŒØ¯ Ø§Ù‚Ù„Ø§Ù… Ù…Ø­Ø¨ÙˆØ¨ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§
            Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯.
          </p>
        </div>
      </section>

      <section class="features" id="features">
        <article class="feature-card">
          <strong>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ø®ØªØµØ§ØµÛŒ</strong>
          <p>Ù‡Ø± ÙØ±Ø¯ Ø¢Ø¯Ø±Ø³ ÛŒÙˆÙ†ÛŒÚ© Ø®ÙˆØ¯Ø´ Ø±Ø§ Ø¯Ø§Ø±Ø¯ ØªØ§ Ø¨Ø§ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±Ø¯.</p>
        </article>
        <article class="feature-card">
          <strong>Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø¯ÛŒÙ‡</strong>
          <p>Ù…Ù‡Ù…Ø§Ù†â€ŒÙ‡Ø§ Ø¢ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ØªÛŒÚ© Ù…ÛŒâ€ŒØ²Ù†Ù†Ø¯ ØªØ§ Ù‡Ø¯Ø§ÛŒØ§ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø´ÙˆØ¯.</p>
        </article>
        <article class="feature-card">
          <strong>Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ù„ÛŒ</strong>
          <p>Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¨Ù‡â€ŒØ³Ø§Ø¯Ú¯ÛŒ Ù‚Ø§Ø¨Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³Øª.</p>
        </article>
      </section>

      <section class="steps">
        <article class="step-card">
          <strong>Û±. Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„</strong>
          <p>Ù…Ø§ Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¹Ù„Ø§ÛŒÙ‚ØŒ Ø¨ÙˆØ¯Ø¬Ù‡ØŒ Ùˆ Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ù…Ø­Ø¨ÙˆØ¨ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
        </article>
        <article class="step-card">
          <strong>Û². Ø§Ø´ØªØ±Ø§Ú© Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†</strong>
          <p>Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Ù† ÛŒØ§ Ù‡Ù…â€ŒØªÛŒÙ…ÛŒâ€ŒÙ‡Ø§ Ø¨ÙØ±Ø³ØªÛŒØ¯ ØªØ§ Ù„ÛŒØ³Øª Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯.</p>
        </article>
        <article class="step-card">
          <strong>Û³. Ù‡Ø¯ÛŒÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</strong>
          <p>Ù…Ù‡Ù…Ø§Ù†â€ŒÙ‡Ø§ Ù…ÙˆØ§Ø±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø±Ø§ ØªÛŒÚ© Ù…ÛŒâ€ŒØ²Ù†Ù†Ø¯ ØªØ§ ØªØ¬Ø±Ø¨Ù‡ Ù‡Ø¯ÛŒÙ‡ Ø¯Ø§Ø¯Ù† Ø¯Ù„Ú†Ø³Ø¨ Ø´ÙˆØ¯.</p>
        </article>
      </section>
    </main>

    <main class="page" id="profilePage" hidden>
      <header>
        <img
          id="profileImage"
          src=""
          alt="ØªØµÙˆÛŒØ± Ù¾Ø±ÙˆÙØ§ÛŒÙ„"
        />
        <div class="profile">
          <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <h1 id="profileTitle" style="margin: 0 0 12px;">Ú©ØªØ§Ø¨Ú†Ù‡ Ù‡Ø¯ÛŒÙ‡</h1>
            <a href="#" id="calendarIconLink" class="calendar-icon-link" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ‚ÙˆÛŒÙ…">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
              </svg>
            </a>
          </div>
          <p id="profileBio"></p>
          <p id="profileDescription">
            Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
          </p>
          <div class="tags" id="profileTags">
          </div>
        </div>
      </header>

      <section class="lists" id="listsContainer">
        <!-- Lists will be dynamically generated -->
      </section>

      <section class="list-card ai-suggestions" id="aiSuggestions" hidden>
        <!-- AI suggestions will be injected here -->
      </section>

      <div class="share" id="profileShare" hidden>
        <button type="button" id="copyLink">Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
        <span id="shareStatus">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: â€”</span>
      </div>

      <footer class="profile-footer" id="profileFooter"></footer>

      <a href="./wallet.html" class="wallet-link" id="walletLink" hidden>
        <span>ğŸ’°</span>
        <span>Ú©ÛŒÙ Ù¾ÙˆÙ„</span>
      </a>

    </main>

    <!-- Contribute Modal -->
    <div id="contributeModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
      <div style="background: var(--card); border-radius: 24px; padding: 32px; max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
        <h2 style="margin: 0 0 16px; color: var(--accent);">Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ø®Ø±ÛŒØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ</h2>
        <p id="contributeItemTitle" style="margin: 0 0 8px; font-weight: 600;"></p>
        <p id="contributeItemInfo" style="margin: 0 0 24px; color: var(--muted); font-size: 14px;"></p>
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ù…Ø¨Ù„Øº Ù…Ø´Ø§Ø±Ú©Øª (ØªÙˆÙ…Ø§Ù†)</label>
        <input type="number" id="contributeAmount" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; font-size: 16px; margin-bottom: 16px;" min="1" />
        <div style="display: flex; gap: 12px;">
          <button onclick="closeContributeModal()" style="flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: #fff; cursor: pointer; font-weight: 600;">Ø§Ù†ØµØ±Ø§Ù</button>
          <button onclick="submitContribution()" style="flex: 1; padding: 12px; border: none; border-radius: 12px; background: var(--accent); color: #fff; cursor: pointer; font-weight: 600;">Ù¾Ø±Ø¯Ø§Ø®Øª</button>
        </div>
      </div>
    </div>

    <script src="./people-config.js"></script>
    <script>
      const UNIVERSAL_DESCRIPTION = 'Ø§ÛŒÙ† ÙÙ‡Ø±Ø³Øª Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Ù† Ùˆ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø§Ø³Øª ØªØ§ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø³Ù„ÛŒÙ‚Ù‡ØŒ Ù†ÛŒØ§Ø² Ùˆ Ø¨ÙˆØ¯Ø¬Ù‡â€ŒÛŒ Ù…Ù†ØŒ Ù‡Ø¯ÛŒÙ‡â€ŒØ§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ù†Ø¯. Ù‡Ù…Ù‡â€ŒÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø¨Ø§ ØªÛŒÚ© Ø²Ø¯Ù†ØŒ Ù‡Ø¯ÛŒÙ‡â€ŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.';


      // Get person from URL parameter
      function getPersonFromURL() {
        const params = new URLSearchParams(window.location.search);
        const person = params.get('person'); // This could be username or personId
        return person;
      }

      // Get personId from username
      function getPersonIdFromUsername(username) {
        if (!username) return null;
        try {
          const usernames = JSON.parse(localStorage.getItem('gift-template-usernames') || '{}');
          return usernames[username.toLowerCase()] || null;
        } catch (e) {
          return null;
        }
      }

      // Get current person data
      function getCurrentPerson() {
        const personParam = getPersonFromURL();
        if (!personParam) return null;
        
        // First try to get from PEOPLE_DATA directly (for existing personIds)
        if (PEOPLE_DATA[personParam]) {
          return PEOPLE_DATA[personParam];
        }
        
        // If not found, try to get personId from username mapping
        const personId = getPersonIdFromUsername(personParam);
        if (personId && PEOPLE_DATA[personId]) {
          return PEOPLE_DATA[personId];
        }
        
        return null;
      }

      // Storage key for saving selections (person-specific)
      function getStorageKey() {
        const personParam = getPersonFromURL();
        if (!personParam) return 'giftWishlistSelections_default';
        
        // Try to get personId from username mapping
        const personId = getPersonIdFromUsername(personParam) || personParam;
        return `giftWishlistSelections_${personId}`;
      }

      // Function to get or create user ID
      function getUserId() {
        let userId = localStorage.getItem('userId');
        if (!userId) {
          userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          localStorage.setItem('userId', userId);
        }
        return userId;
      }

      // Render profile section
      function renderProfile(person) {
        document.getElementById('pageTitle').textContent = `Ú©ØªØ§Ø¨Ú†Ù‡ Ù‡Ø¯ÛŒÙ‡ ${person.name}`;
        document.getElementById('profileImage').src = person.image || 'https://wallpapers.com/images/featured/cute-aesthetic-profile-pictures-pjfl391j3q0f7rlz.jpg';
        document.getElementById('profileImage').alt = `ØªØµÙˆÛŒØ± Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ${person.name}`;
        document.getElementById('profileTitle').textContent = `Ú©ØªØ§Ø¨Ú†Ù‡ Ù‡Ø¯ÛŒÙ‡ ${person.name}`;
        document.getElementById('profileDescription').textContent = UNIVERSAL_DESCRIPTION;
        
        // Set calendar icon link
        const personParam = getPersonFromURL();
        const calendarIconLink = document.getElementById('calendarIconLink');
        if (calendarIconLink && personParam) {
          calendarIconLink.href = `./calendar.html?person=${personParam}`;
        }
        
        const bioElement = document.getElementById('profileBio');
        if (person.bio || person.description) {
          bioElement.textContent = person.bio || person.description;
          bioElement.style.display = 'block';
        } else {
          bioElement.textContent = '';
          bioElement.style.display = 'none';
        }
        
        const tagsContainer = document.getElementById('profileTags');
        tagsContainer.innerHTML = '';
        (person.tags || []).forEach(tag => {
          const span = document.createElement('span');
          span.textContent = tag;
          tagsContainer.appendChild(span);
        });
        const footer = document.getElementById('profileFooter');
        if (footer) {
          footer.textContent = person.footer || 'Ù…Ø­Ø¨Øª Ø´Ù…Ø§ Ø§Ø±Ø²Ø´Ù…Ù†Ø¯ØªØ±ÛŒÙ† Ù‡Ø¯ÛŒÙ‡ Ø§Ø³Øª. Ù…Ù…Ù†ÙˆÙ† Ø§Ø² ØªÙˆØ¬Ù‡â€ŒØªØ§Ù†.';
        }
        const shareContainer = document.getElementById('profileShare');
        if (shareContainer) {
          shareContainer.removeAttribute('hidden');
        }
        const shareStatus = document.getElementById('shareStatus');
        if (shareStatus) {
          shareStatus.textContent = `Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${person.lastUpdate || 'â€”'}`;
        }
      }

      // Render lists
      function renderLists(person) {
        const container = document.getElementById('listsContainer');
        container.innerHTML = '';
        const personParam = getPersonFromURL();

        Object.keys(person.lists).forEach(listKey => {
          const list = person.lists[listKey];
          const listCard = document.createElement('article');
          listCard.className = 'list-card';
          listCard.setAttribute('data-list', listKey);
          const isSelectable = list.selectable !== false;

          const itemsCount = list.items.length;
          let itemsHTML = '';

          list.items.forEach(item => {
            const hasPrice = item.price !== undefined;
            const hasLink = item.link !== undefined;
            const itemTag = isSelectable ? 'label' : 'div';
            const itemClasses = isSelectable ? 'item' : 'item item-static';
            const dataAttr = isSelectable && item.value ? `data-product="${item.value}"` : '';
            const checkboxHTML = isSelectable
              ? `<input type="checkbox" value="${item.value || item.title}" />`
              : '';

            const hasPriority = item.priority && item.priority.trim() !== '';
            const priorityPill = hasPriority ? `<span style="display: inline-block; background: #fff1f1; color: var(--accent); padding: 4px 10px; border-radius: 999px; font-size: 12px; margin-left: 6px;">Ø§ÙˆÙ„ÙˆÛŒØª: ${item.priority}</span>` : '';

            // Get group purchase data
            const itemId = item.value || item.title;
            const purchaseData = getGroupPurchaseData(itemId, person);
            const hasContributions = purchaseData.totalContributed > 0;
            const priceNum = hasPrice ? parsePrice(item.price) : 0;
            const progressPercent = priceNum > 0 ? Math.min((purchaseData.totalContributed / priceNum) * 100, 100) : 0;
            const remainingAmount = Math.max(0, priceNum - purchaseData.totalContributed);

            let groupPurchaseHTML = '';
            if (hasPrice && priceNum > 0) {
              const itemTitleEscaped = item.title.replace(/'/g, "\\'");
              groupPurchaseHTML = `
                <div class="group-purchase-section">
                  ${hasContributions ? `
                    <div class="progress-info">
                      <span>Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡: <span class="progress-amount">${formatPrice(purchaseData.totalContributed)} ØªÙˆÙ…Ø§Ù†</span></span>
                      <span>${Math.round(progressPercent)}%</span>
                    </div>
                    <div class="progress-bar-container">
                      <div class="progress-bar-fill" style="width: ${progressPercent}%"></div>
                    </div>
                  ` : ''}
                  <button class="contribute-btn" onclick="event.stopPropagation(); openContributeModal('${itemId}', '${itemTitleEscaped}', ${priceNum}, ${remainingAmount}, '${person.name || personParam || ''}')">
                    ${hasContributions ? 'Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ø®Ø±ÛŒØ¯' : 'Ø´Ø±ÙˆØ¹ Ø®Ø±ÛŒØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ'}
                  </button>
                </div>
              `;
            }

            itemsHTML += `
              <${itemTag} class="${itemClasses}" ${dataAttr}>
                ${checkboxHTML}
                <div class="item-content">
                  <strong>${item.title}</strong>
                  <span>${item.description}</span>
                  ${priorityPill ? `<div style="margin-top: 6px;">${priorityPill}</div>` : ''}
                  ${hasPrice ? `<div class="item-price">Ù‚ÛŒÙ…Øª: ${item.price} ØªÙˆÙ…Ø§Ù†</div>` : ''}
                  ${hasLink ? `<div class="item-link">
                    <a href="${item.link}" target="_blank" onclick="event.stopPropagation()">
                      ${item.linkText || 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ â†’'}
                    </a>
                  </div>` : ''}
                  ${groupPurchaseHTML}
                </div>
              </${itemTag}>
            `;
          });

          listCard.innerHTML = `
            <div class="list-header">
              <div class="list-title">
                <h2>${list.title}</h2>
                <span>${list.description}</span>
              </div>
              ${isSelectable ? `<div class="counter">
                <strong>0</strong> / ${itemsCount} Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
              </div>` : ''}
            </div>
            <div class="items-grid">
              ${itemsHTML}
            </div>
          `;

          container.appendChild(listCard);
        });

        renderAISuggestions(person);
      }

      // Render AI-powered product suggestions
      function renderAISuggestions(person) {
        const aiSection = document.getElementById('aiSuggestions');
        if (!aiSection) return;

        const productsList = person?.lists?.products;
        if (!productsList || !productsList.items || !productsList.items.length) {
          aiSection.setAttribute('hidden', 'true');
          aiSection.innerHTML = '';
          return;
        }

        const stores = ['Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§', 'Ø¢Ù…Ø§Ø²ÙˆÙ†', 'Ú©Ø§ÙÙ‡â€ŒØ¨Ø§Ø²Ø§Ø±', 'Ø§ÛŒØ±Ø§Ù†â€ŒÙ…Ø§Ù„', 'ØªØ±Ø¨'];
        const aiItems = productsList.items.slice(0, 4).map((item, idx) => ({
          title: item.title,
          description: item.description || 'Ú¯Ø²ÛŒÙ†Ù‡ Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù„ÛŒÙ‚Ù‡ Ø´Ù…Ø§',
          price: item.price || 'Ù…ØªØºÛŒØ±',
          vendor: stores[idx % stores.length],
          link: item.link || '#'
        }));

        const itemsHTML = aiItems.map((ai) => `
          <div class="ai-card">
            <strong>${ai.title}</strong>
            <small>${ai.description}</small>
            <div class="item-price">Ù‚ÛŒÙ…Øª ØªØ®Ù…ÛŒÙ†ÛŒ: ${ai.price}</div>
            <div class="item-link">
              <a href="${ai.link}" target="_blank" onclick="event.stopPropagation()">
                Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± ${ai.vendor}
              </a>
            </div>
          </div>
        `).join('');

        aiSection.innerHTML = `
          <div class="list-header">
            <div class="list-title">
              <div class="ai-pill">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ AI</div>
              <span>Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ù„Ø§ÛŒÙ‚ Ø´Ù…Ø§ Ø§Ø² ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù</span>
            </div>
          </div>
          <div class="ai-grid">
            ${itemsHTML}
          </div>
        `;
        aiSection.removeAttribute('hidden');
      }

      function prepareWishlistDraft(person) {
        if (!person || !person.lists || !person.lists.products) return null;
        const profileDraft = {
          fullName: `${person.name || ''} ${person.fullName || ''}`.trim(),
          constraints: person.bio || person.description || ''
        };

        const itemsDraft = (person.lists.products.items || []).map((item, idx) => ({
          id: `seed-${idx}-${Date.now()}`,
          title: item.title || '',
          category: item.category || '',
          link: item.link || '',
          budget: item.price || '',
          priority: item.priority || 'Ù…Ù‡Ù…',
          options: item.options || '',
          notes: item.description || ''
        }));

        return { profile: profileDraft, items: itemsDraft };
      }

      // Function to load saved selections
      function loadSelections() {
        try {
          const userId = getUserId();
          const saved = localStorage.getItem(getStorageKey());
          if (saved) {
            const selections = JSON.parse(saved);
            const userSelections = selections[userId] || {};
            
            document.querySelectorAll('input[type="checkbox"]').forEach((checkbox) => {
              const value = checkbox.value;
              if (userSelections[value]) {
                checkbox.checked = true;
                const item = checkbox.closest('.item');
                if (item) {
                  item.classList.add('checked');
                }
              }
            });
          }
        } catch (error) {
          console.error('Error loading selections:', error);
        }
      }

      // Function to save selections
      function saveSelections() {
        try {
          const userId = getUserId();
          const saved = localStorage.getItem(getStorageKey());
          let selections = saved ? JSON.parse(saved) : {};
          
          const checkedItems = {};
          document.querySelectorAll('input[type="checkbox"]:checked').forEach((checkbox) => {
            checkedItems[checkbox.value] = true;
          });
          
          selections[userId] = checkedItems;
          selections[userId + '_timestamp'] = new Date().toISOString();
          
          localStorage.setItem(getStorageKey(), JSON.stringify(selections));
        } catch (error) {
          console.error('Error saving selections:', error);
        }
      }

      // Initialize page
      function initPage() {
        const person = getCurrentPerson();
        const profilePage = document.getElementById('profilePage');
        const homePage = document.getElementById('homePage');
        const shareContainer = document.getElementById('profileShare');

        if (!person) {
          if (profilePage) profilePage.setAttribute('hidden', 'true');
          if (homePage) homePage.removeAttribute('hidden');
          if (shareContainer) shareContainer.setAttribute('hidden', 'true');
          return;
        }

        if (homePage) homePage.setAttribute('hidden', 'true');
        if (profilePage) profilePage.removeAttribute('hidden');

        renderProfile(person);
        renderLists(person);
        setupProfileEditing(person);

      // Initialize counters and event listeners
        setTimeout(() => {
      const counters = document.querySelectorAll(".list-card");
      counters.forEach((listCard) => {
        const checkboxes = listCard.querySelectorAll("input[type='checkbox']");
        const counter = listCard.querySelector(".counter strong");
        if (!counter) return; // Skip if no counter (non-selectable lists)
        
        const updateCounter = () => {
          const checked = Array.from(checkboxes).filter((box) => box.checked);
          counter.textContent = checked.length;
        };
        
        checkboxes.forEach((box) => {
          box.addEventListener("change", () => {
            const item = box.closest('.item');
            if (box.checked) {
              item.classList.add('checked');
            } else {
              item.classList.remove('checked');
            }
            updateCounter();
                saveSelections();
          });
        });
        
        updateCounter();
      });

      // Load saved selections
      loadSelections();
      
      // Update counters after loading
      counters.forEach((listCard) => {
        const checkboxes = listCard.querySelectorAll("input[type='checkbox']");
        const counter = listCard.querySelector(".counter strong");
        if (!counter) return; // Skip if no counter (non-selectable lists)
        const checked = Array.from(checkboxes).filter((box) => box.checked);
        counter.textContent = checked.length;
      });
        }, 0);
      }

      // Share button functionality
      const shareButton = document.getElementById('copyLink');
      const shareStatus = document.getElementById('shareStatus');
      if (shareButton) {
        shareButton.addEventListener('click', async () => {
          try {
            const personParam = getPersonFromURL();
            const person = getCurrentPerson();
            if (!personParam || !person) {
              if (shareStatus) {
                shareStatus.textContent = 'Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©ØŒ Ø§Ø¨ØªØ¯Ø§ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ø®ØªØµØ§ØµÛŒ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.';
              }
              return;
            }
            // Use the username from URL (personParam) for the share link
            const url = `https://esmailiyan.github.io/index.html?person=${personParam}`;
            await navigator.clipboard.writeText(url);
            if (shareStatus) {
              shareStatus.textContent = 'Ù„ÛŒÙ†Ú© Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ù¾ÛŒ Ø´Ø¯!';
            }
          } catch (error) {
            if (shareStatus) {
              shareStatus.textContent = 'Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡â€ŒÛŒ Ú©Ù¾ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ø¯Ø§Ø¯Ø› Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªÛŒ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯.';
            }
          }
        });
      }

      // Redirect owner to editable form with preloaded data
      function setupProfileEditing(person) {
        const avatar = document.getElementById('profileImage');
        if (!avatar || !person) return;
        avatar.title = 'Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ ÙÙ‡Ø±Ø³Øª Ø®ÙˆØ¯ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯';

        avatar.addEventListener('click', () => {
          const draft = prepareWishlistDraft(person);
          if (draft) {
            sessionStorage.setItem('wishlistImport', JSON.stringify(draft));
          }
          const personParam = getPersonFromURL();
          // Get actual personId from username mapping or use personParam if it's already a personId
          const personId = getPersonIdFromUsername(personParam) || personParam;
          const target = `./profile.html${personId ? `?person=${personId}` : ''}`;
          window.location.href = target;
        });
      }

      // Group Purchase Functions
      function getStorageKeyForPurchases() {
        const personParam = getPersonFromURL();
        if (!personParam) return 'groupPurchases_default';
        const personId = getPersonIdFromUsername(personParam) || personParam;
        return `groupPurchases_${personId}`;
      }

      function getGroupPurchaseData(itemId, person) {
        try {
          const storageKey = getStorageKeyForPurchases();
          const data = JSON.parse(localStorage.getItem(storageKey) || '{}');
          const itemData = data[itemId] || { contributions: [] };
          const totalContributed = itemData.contributions.reduce((sum, c) => sum + (c.amount || 0), 0);
          return {
            contributions: itemData.contributions || [],
            totalContributed: totalContributed
          };
        } catch (e) {
          return { contributions: [], totalContributed: 0 };
        }
      }

      function parsePrice(priceStr) {
        if (!priceStr) return 0;
        let str = String(priceStr);
        // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø¹Ø±Ø¨ÛŒ Ø¨Ù‡ Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
        const persianDigits = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];
        const arabicDigits = ['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©'];
        persianDigits.forEach((d, i) => {
          const regex = new RegExp(d, 'g');
          str = str.replace(regex, String(i));
        });
        arabicDigits.forEach((d, i) => {
          const regex = new RegExp(d, 'g');
          str = str.replace(regex, String(i));
        });
        const cleaned = str.replace(/[^\d]/g, '');
        return parseInt(cleaned, 10) || 0;
      }

      function formatPrice(amount) {
        return amount.toLocaleString('fa-IR');
      }

      let currentContributeData = null;

      function openContributeModal(itemId, itemTitle, totalPrice, remainingAmount, personName) {
        currentContributeData = { itemId, itemTitle, totalPrice, remainingAmount, personName };
        const modal = document.getElementById('contributeModal');
        const titleEl = document.getElementById('contributeItemTitle');
        const infoEl = document.getElementById('contributeItemInfo');
        const amountEl = document.getElementById('contributeAmount');

        titleEl.textContent = itemTitle;
        infoEl.textContent = `Ù‚ÛŒÙ…Øª Ú©Ù„: ${formatPrice(totalPrice)} ØªÙˆÙ…Ø§Ù† | Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡: ${formatPrice(remainingAmount)} ØªÙˆÙ…Ø§Ù†`;
        amountEl.value = '';
        amountEl.max = remainingAmount;
        modal.style.display = 'flex';
        amountEl.focus();
      }

      function closeContributeModal() {
        const modal = document.getElementById('contributeModal');
        modal.style.display = 'none';
        currentContributeData = null;
      }

      function submitContribution() {
        if (!currentContributeData) return;

        const amountEl = document.getElementById('contributeAmount');
        const amount = parseInt(amountEl.value);

        if (!amount || amount <= 0) {
          alert('Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
          return;
        }

        if (amount > currentContributeData.remainingAmount) {
          alert(`Ù…Ø¨Ù„Øº Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ${formatPrice(currentContributeData.remainingAmount)} ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ø´Ø¯`);
          return;
        }

        try {
          const storageKey = getStorageKeyForPurchases();
          const data = JSON.parse(localStorage.getItem(storageKey) || '{}');
          if (!data[currentContributeData.itemId]) {
            data[currentContributeData.itemId] = { contributions: [] };
          }

          const userId = getUserId();
          data[currentContributeData.itemId].contributions.push({
            userId: userId,
            amount: amount,
            timestamp: new Date().toISOString(),
            contributorName: 'Ø´Ù…Ø§'
          });

          localStorage.setItem(storageKey, JSON.stringify(data));
          alert(`Ù…Ø¨Ù„Øº ${formatPrice(amount)} ØªÙˆÙ…Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯!`);
          closeContributeModal();
          
          // Reload the page to show updated progress
          const person = getCurrentPerson();
          if (person) {
            renderLists(person);
          }
        } catch (e) {
          alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
          console.error(e);
        }
      }

      // Close modal on outside click
      document.addEventListener('click', (e) => {
        const modal = document.getElementById('contributeModal');
        if (e.target === modal) {
          closeContributeModal();
        }
      });

      // Show wallet link
      function showWalletLink() {
        const walletLink = document.getElementById('walletLink');
        if (walletLink) {
          const personParam = getPersonFromURL();
          if (personParam) {
            walletLink.href = `./wallet.html?person=${personParam}`;
          }
          walletLink.removeAttribute('hidden');
        }
      }

      // Initialize on page load
      initPage();
      showWalletLink();
    </script>
  </body>
</html>